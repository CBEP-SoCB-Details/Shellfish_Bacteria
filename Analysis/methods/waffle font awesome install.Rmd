---
title: "R Notebook"
output: html_notebook
---

# Introduction
I had some trouble installing the Font Awesome fonts.  I even went so far as to uninstall ("remove packages) and reinstall (install.packages) the fontextra and fontextradb packages so that we were starting with an empty windows font database.  And I removed and reinstalled the Font Awesome fonts several times, but that too appeared to have no effect.  I suspect the problems are deeply buriend in how Windows tracks fonts.
## Lessons
1.  The Font Awesome fonts do not appear to be found or recognized as installable fonts in the Windows Font folder, but they can be successfully installed from elsewhere.
2.  Even after a succesful install, Waffle has trouble finding the Font Awesome fonts until you
a. run loadfonts(), and
b. restart R.

# Setup
Before running any of this code, a TTF version of the Font Awesome Free Fonts should be installed in Windows - -although that does not appear to have worked in this case.

Careful, you want the .ttf versionof hte fonts, not .otf or one of the other formats.

```{r}
library(tidyverse)
library(ggplot2)
library(extrafont)
library(waffle)
```

The Waffle package allows use of glyphs for graphics.  By default it looks for glyphs from the "Font Awesome" font family, although the help systems suggests it is capable of pulling glyphs from other fonts as well.  
The Font Awesome fonts are availalbe through:
https://fontawesome.com/  or
https://github.com/FortAwesome/Font-Awesome.
## Are the Fonts Already Installed?
Lets look at the extrafonts windows font database.
```{r}
loadfonts(quiet=TRUE)
extrafont::fonttable() %>% 
  as_tibble() %>% 
  filter(grepl("Awesom", FamilyName)) %>% 
  select(afmfile, FullName, FamilyName, FontName)
```

# Installing Fonts
## Simplest way
Waffle provides an installer function that should install these fonts, but it has not worked for me.  Note that the warning here is produced even though the fonts are already installed in Windows.
```{r}
install_fa_fonts()
```
Buried in the help file is the warning "you must use the Font Awesome 5 fonts bundled with the package." I have installed files with identical file names downloaded from the Font Awesome Github page. But the files are not identical -- the files from Font Awesome are ever so slightly larger.  Did that cause some of the problems I've had using this package?

I reinstalled on Windows, removed and reinstalled the extrafont and extrafontdb packages (to reset the windows font database) and tried again.  No better outcomes.
## Slightly More Complex
For all the font_import calls, it is important in an RNotebook to set "prompt=FALSE" to avoid waiting forever for a confirmation.  BY default, RNotebook provides no ready way for the user to respond to an interactive prompt.
```{r error=TRUE}
font_import(pattern = '[Ff]ont [Aa]wesome', prompt = FALSE)
```
While the error message is confusing, what it means in practice is that extrafont has not found a match for the proposed pattern.  This despite the fact that I can see the Font Awesme packages in the default windows font folder, so it should b e 
### Very Slow
The following code uploads ALL ttf (NOT OTF) fonts in the standard windows font folder. but for some reason,  the font awesome fonts do not loaded properly even though I can see them in the Fonts folder, and can confirm that they are ttf fonts.....

Since this loads or reloads all fonts in the default fonts folder, it takes a long time -- on the order of 15 minutes to load the ~ 530 fonts on my work machine, and about 5 minutes to load the ~ 100 fonts on my home computer.  So, running this is not really recommended unless you have to do it.  The chunck option eval=FALSE prevents the code from running when the RNotebook is rendered, although not if you click on the "run" arrow on the chunk.
```{r eval=FALSE}
font_import(paths = 'C:\\Windows\\Fonts', prompt = FALSE)
```
We can determine whether the Font Awesome Fonts have been installed several different ways.
```{r}
fonts()[grep("Awesome", fonts())]
```
So, somehow, that has not worked.  Why not?
### Install From Another Folder
I downloaded a version of the fonts installed with the package, and also downloaded another version direct from Font Awesome's GitHub page. I installed each into the windows font folder multiple times. buthte original files are still available in these other folders.  We ARE able to install these fonts from these other locations.  
```{r}
pathtodownloads <- 'C:/Users/cbohl/Documents/R/win-library/3.6/waffle/fonts'
#pathtodownloads <- 'C:\\Users\\curtis.bohlen\\Downloads'   # Work laptop
#pathtodownloads <- 'C:\\Users\\cbohl\\Downloads'       # home laptop
font_import(paths = pathtodownloads, prompt = FALSE)
```
## Are the Fonts Installed?
```{r}
fonts()[grep("Awesome", fonts())]
```
Lets also look at the extrafonts windows font database.
```{r}
loadfonts(quiet=TRUE)
extrafont::fonttable() %>% 
  as_tibble() %>% 
  filter(grepl("Awesom", FamilyName)) %>% 
  select(afmfile, FullName, FamilyName, FontName)
```
# Test with a Waffle Graphic using Glyphs
First, make sure fonts are available to call in graphics.
```{r}
loadfonts(quiet = TRUE)
```
The following worked only AFTER restarting R, but it did eventually work.
```{r}
waffle(c(50, 30, 15, 5), rows = 5, use_glyph = 'ambulance',
       glyph_font_family="Font Awesome 5 Free Solid", glyph_size = 6)
```
It's worth pointing out that the help files suggest waffle can use glyphs from other fonts as well.  If so, all the wingdings and ESRI cartography symbols are available too (by unicode).

The waffle package provides a nice function that creates a searchable list of Font Awesome glyphs. This suggests all these glyphs should be available by name, but that has not been my experience.  Digging into the code, this dataframe appears to be loaded independently of the presence of the fonts. But I don't understand how the glyphs show up here if I can't access them through the other waffle functions.
```{r}
fa_list()
```
